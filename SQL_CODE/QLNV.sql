--TẠO CSDL QLNV
CREATE DATABASE QLNV
ON(
NAME = 'QLNV',
FILENAME = 'F:\CSDL\SQL_DATA\QLNV.mdf',
SIZE = 10 MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 5 MB)
LOG ON(
NAME = 'QLNV_LOG',
FILENAME = 'F:\CSDL\SQL_DATA\QLNV.ldf',
SIZE = 5 MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 2 MB)
GO

USE QLNV

--TẠO BẢNG NHANVIEN
CREATE TABLE NHANVIEN
(
MANV VARCHAR(8) PRIMARY KEY,
HONV NVARCHAR(50) NOT NULL,
TENLOT NVARCHAR(50) NOT NULL,
TENNV NVARCHAR(50) NOT NULL,
NGAYSINH DATE NULL,
PHAI NVARCHAR(5) NULL,
CONSTRAINT PHAI_CHK CHECK (PHAI IN (N'Nam',N'Nữ')),
DCHI NVARCHAR(100) NULL,
MLUONG FLOAT NOT NULL,
MA_NQL VARCHAR(8) NULL,
PHONG VARCHAR(4) NULL
)
GO

--TẠO BẢNG THÂN NHÂN
CREATE TABLE THANNHAN
(
MATN VARCHAR(8) NOT NULL,
MANV VARCHAR(8) NOT NULL,
TENTN NVARCHAR(50) NULL,
PHAI NVARCHAR(5) NULL CONSTRAINT PHAITN_CHK CHECK(PHAI IN (N'Nam',N'Nu')),
NGSINH DATE NULL,
QUANHE NVARCHAR(30) NULL,
CONSTRAINT PK_TN PRIMARY KEY(MATN,MANV)
)
GO

--TẠO BẢNG PHÒNG BAN
CREATE TABLE PHONGBAN
(
MAPHONG VARCHAR(4) PRIMARY KEY,
TENPHONG NVARCHAR(100) NULL,
TRPHONG VARCHAR(8) NULL,
NGNC DATE NULL
)


--TẠO BANG DIADIEM_PHONG
CREATE TABLE DIADIEM_PHG
(
MAPHG VARCHAR(4) NOT NULL,
DIADIEM NVARCHAR(50) NOT NULL,
CONSTRAINT PK_DDPHG PRIMARY KEY(MAPHG,DIADIEM)
)

GO

--TẠO BẢNG PHANCONG
CREATE TABLE PHANCONG
(
MANV VARCHAR(8) NOT NULL,
MADA VARCHAR(8) NOT NULL,
THOIGIAN FLOAT NULL,
CONSTRAINT PK_PC PRIMARY KEY(MANV,MADA)
)
GO

--TẠO BẢNG DEAN
CREATE TABLE DEAN
(
MADA VARCHAR(8) PRIMARY KEY,
MAPHG VARCHAR(4) NOT NULL,
TENDA NVARCHAR(50) NULL,
DDIEM_DA NVARCHAR(50),
NGBD_DK DATE NULL,
NGKT_DK DATE NULL
)
GO

--ĐẶT KHÓA NGOẠI CHO CÁC BẢNG

--BẢNG NHANVIEN
ALTER TABLE dbo.NHANVIEN ADD CONSTRAINT FK_NQL FOREIGN KEY(MA_NQL) REFERENCES dbo.NHANVIEN(MANV)
ALTER TABLE dbo.NHANVIEN ADD CONSTRAINT FK_PHG FOREIGN KEY(PHONG) REFERENCES dbo.PHONGBAN(MAPHONG)
GO

--BẢNG THANNHAN
ALTER TABLE dbo.THANNHAN ADD CONSTRAINT FK_TN FOREIGN KEY(MANV) REFERENCES dbo.NHANVIEN(MANV)
GO

--BẢNG PHONGBAN
ALTER TABLE dbo.PHONGBAN ADD CONSTRAINT FK_TRP FOREIGN KEY(TRPHONG) REFERENCES dbo.NHANVIEN(MANV)
GO

--BẢNG DIADIEM_PHG
ALTER TABLE dbo.DIADIEM_PHG ADD CONSTRAINT FK_MAPHG FOREIGN KEY(MAPHG) REFERENCES dbo.PHONGBAN(MAPHONG)
GO

--BẢNG PHANCONG
ALTER TABLE dbo.PHANCONG ADD CONSTRAINT FK_NV FOREIGN KEY(MANV) REFERENCES dbo.NHANVIEN(MANV)
ALTER TABLE dbo.PHANCONG ADD CONSTRAINT FK_DA FOREIGN KEY(MADA) REFERENCES dbo.DEAN(MADA)
GO

-- BẢNG DEAN
ALTER TABLE dbo.DEAN ADD CONSTRAINT FK_DA_PHG FOREIGN KEY(MAPHG) REFERENCES dbo.PHONGBAN(MAPHONG)
GO

-- NHẬP DỮ LIỆU CHO CÁC BẢNG

--BẢNG NHANVIEN (CHƯA THÊM ĐƯỢC MÃ PHÒNG)
INSERT INTO NHANVIEN(MANV,HONV,TENLOT,TENNV,NGAYSINH,PHAI,DCHI,MA_NQL,MLUONG) VALUES
('001',N'Vương',N'Ngọc',N'Quyên','10/22/1957',N'Nữ',N'450 Trưng Vương, Hà Nội',NULL,3000000),
('002',N'Nguyễn',N'Thanh',N'Tùng','01/06/1955',N'Nam',N'731 Trần Hưng Đạo, Q1, TpHCM','001',2500000),
('003',N'Lê',N'Thị',N'Nhàn','12/18/1960',N'Nữ',N'291 Hồ Văn Huệ, QPN, TpHCM','001',2500000),
('004',N'Đinh',N'Bá',N'Tiến','01/09/1968',N'Nam',N'638 Nguyễn Văn Cừ, Q5, TpHCM','002',2200000),
('005',N'Bùi',N'Thúy',N'Vũ','07/19/1972',N'Nam',N'332 Nguyễn Thái Học, Q1, TpHCM','003',2200000),
('006',N'Nguyễn',N'Mạnh',N'Hùng','09/15/1973',N'Nam',N'976 Bà Rịa, Vũng Tàu','002',2000000),
('007',N'Trần',N'Thanh',N'Tâm','07/31/1975',N'Nữ',N'543 Mai Thị Lưu, Q1, TpHCM','002',2200000),
('008',N'Trần',N'Hồng',N'Vân','07/04/1976',N'Nữ',N'960 Lê Hồng Phong, Q10, TpHCM','004',1800000)
GO

--BẢNG PHONGBAN
INSERT INTO PHONGBAN (MAPHONG, TENPHONG,TRPHONG,NGNC) VALUES
('QL',N'Quản Lý','001','05/22/2000'),
('DH',N'Điều Hành','003','10/10/2002'),
('NC',N'Nghiên Cứu','002','03/15/2002')
GO

--CỘT MAPHONG BẢNG NHANVIEN
UPDATE dbo.NHANVIEN
SET PHONG=
CASE
	WHEN MANV='001' THEN 'QL'
	WHEN MANV='002' OR MANV='004' OR MANV='006' OR MANV='007' OR MANV='008' THEN 'NC'
	WHEN MANV='003' OR MANV='005' THEN 'DH'
END
GO

-- BẢNG DEAN
INSERT INTO DEAN(MADA,TENDA,DDIEM_DA,MAPHG,NGBD_DK,NGKT_DK) VALUES
('TH001',N'Tin học hoá 1','HANOI','NC','02/01/2003','02/01/2004'),
('TH002',N'Tin học hoá 2','TPHCM','NC','06/04/2003','02/01/2004'),
('DT001',N'Đào tạo 1','NHATRANG','DH','02/01/2002','02/01/2006'),
('DT002',N'Đào tạo 2','HANOI','DH','02/01/2002','02/01/2004')
GO

--BẢNG PHANCONG
INSERT INTO PHANCONG (MANV,MADA,THOIGIAN) VALUES
('001','TH001',30.0),
('001','TH002',12.5),
('002','TH001',10.0),
('002','TH002',10.0),
('002','DT001',10.0),
('002','DT002',10.0),
('003','TH001',37.5),
('004','DT001',22.5),
('004','DT002',10.0),
('006','DT001',30.5),
('007','TH001',20.0),
('007','TH002',10.0),
('008','TH001',10.0),
('008','DT002',12.5)
GO

-- BẢNG THANNHAN
INSERT INTO THANNHAN(MANV,MATN,TENTN,PHAI,NGSINH,QUANHE)VALUES
('003','1',N'Trần Minh Tiến',N'Nam','12/11/1990',N'Con'),
('003','2',N'Trần Ngọc Linh',N'Nu','03/10/1993',N'Con'),
('003','3',N'Trần Minh Long',N'Nam','10/10/1957',N'Vợ Chồng'),
('001','1',N'Lê Minh Nhật',N'Nam','04/27/1955',N'Vợ Chồng'),
('002','1',N'Lê Hoài Thương',N'Nu','12/05/1960',N'Vợ Chồng'),
('004','1',N'Lê Thị Phụng',N'Nu','12/23/1972',N'Vợ Chồng'),
('005','1',N'Trần Thu Hồng',N'Nu','04/11/1978',N'Vợ Chồng'),
('005','2',N'Nguyễn Mạnh Tâm',N'Nam','01/13/2003',N'Con')
GO

INSERT INTO DIADIEM_PHG VALUES
('NC','HANOI'),
('NC','TPHCM'),
('QL','TPHCM'),
('DH','HANOI'),
('DH','TPHCM'),
('DH','NHATRANG')