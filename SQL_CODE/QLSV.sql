/*
---------------------------
BÀI TOÁN QUẢN LÝ SINH VIÊN
---------------------------
SINHVIEN (MASV,TENSINHVIEN,NAMNH,MAKHOA,)

KHOA ( MAKHOA,TENKHOA,NAMTL)

MONHOC(MAMH,TENMH,TINCHI,MAKHOA)

HOCPHAN( MAHP, HOCKY, NAMHOC,GIAOVIEN, MAMH)

KETQUA(MASV, MAMH, DIEM)

DIEUKIEN (MAHP, MAHPTRUOC)*/
GO

-- TẠO DATABASE 

CREATE DATABASE QLSV
ON(
NAME = 'QLSV',
FILENAME = 'F:\CSDL\SQL_DATA\QLSV.mdf',
SIZE = 10 MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 5 MB)
LOG ON(
NAME = 'QLSV_LOG',
FILENAME = 'F:\CSDL\SQL_DATA\QLSV.ldf',
SIZE = 5 MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 2 MB)
GO

-- CREATE TABLE

USE QLSV

/*BẢNG SINHVIEN
MASV - diễn giải - char - 12 -  - PK
TEN  - diễn giải - nvarchar - 100 - not null
NAM  - diễn giải - int -   -   - {1,2,3,4}
MAKHOA-diễn giải - varchar - 6 - MKxxxx - not null,FK*/

CREATE TABLE SINHVIEN
(
MASV CHAR(8) PRIMARY KEY,
TEN NVARCHAR(100) NOT NULL,
NGAYSINH DATE NULL,
NAM INT DEFAULT 1 CONSTRAINT NAM_CHK CHECK(NAM>=1 OR NAM<=6) NULL,
MAKHOA VARCHAR(10) NOT NULL,
CONSTRAINT FK_SV_KHOA FOREIGN KEY (MAKHOA) REFERENCES dbo.KHOA(MAKHOA)
)
GO


/*BẢNG KHOA
MAKHOA - diễn giải - varchar - 6 - MKxxxx - not null,PK
TENKHOA- diễn giải - nvarchar- 100-not null
NAMTL  - diễn giải - int*/

CREATE TABLE KHOA
(
MAKHOA VARCHAR(10) NOT NULL PRIMARY KEY,
TENKHOA NVARCHAR(50) NOT NULL UNIQUE,
NAMTL INT NULL
)
GO


/*BẢNG MONHOC
MAMH - diễn giải - varchar - 10 - PK,not null,unique
MONHOC diễn giải - nvarchar- 100- not null
TINCHI diễn giải - int     - not null
MAKHOA diễn giải - varchar -6   - FK,not null*/

CREATE TABLE MONHOC
(
MAMH CHAR(6) PRIMARY KEY,
TENMH NVARCHAR(100) UNIQUE NOT NULL,
TINCHI INT DEFAULT 3 CONSTRAINT CHK_TINCHI CHECK (TINCHI>=3 AND TINCHI<=6) NULL,
MAKHOA VARCHAR(10) NOT NULL,
CONSTRAINT FK_MAMH_MAKHOA FOREIGN KEY (MAKHOA) REFERENCES dbo.KHOA(MAKHOA)
)
GO

/*BẢNG HOCPHAN
MAHP - diễn giải - varchar - 100 - PK
HOCKY- diễn giải - int           - not null
NAMHOC diễn giải - int           - not null
GIAOVIEN         - nvarchar - 100 not null
MAMH - diễn giải - varchar - 10 - FK*/

CREATE TABLE HOCPHAN
(
MAHP VARCHAR(10) PRIMARY KEY,
HOCKY INT CONSTRAINT CHK_HOCKY CHECK(HOCKY IN (1,2,3)) NULL,
NAMHOC INT NULL CONSTRAINT CHK_NAMHOC CHECK (YEAR(GETDATE())>=NAMHOC),
GIAOVIEN NVARCHAR(50) NULL,
MAMH CHAR(6) NOT NULL CONSTRAINT FK_HP_MAMH FOREIGN KEY (MAMH) REFERENCES dbo.MONHOC(MAMH)
)
go

/*BẢNG KETQUA
MASV - char - 12 - PK,FK
MAMH - varchar10 - PK,FK
DIEM - int*/

CREATE TABLE KETQUA
(
MASV CHAR(8) NOT NULL,
MAHP VARCHAR(10) NOT NULL,
DIEM FLOAT DEFAULT 0 NULL,
CONSTRAINT DIEM_CHK CHECK (DIEM>=0 AND DIEM<=10),
CONSTRAINT PK_KQ PRIMARY KEY(MASV,MAHP),
CONSTRAINT FK_MASV FOREIGN KEY (MASV) REFERENCES dbo.SINHVIEN(MASV),
CONSTRAINT FK_MAHP FOREIGN KEY (MAHP) REFERENCES dbo.HOCPHAN(MAHP),
)
GO

/*BẢNG DIEUKIEN
MAHP - varchar - 10 - PK,FK
MAHPTRUOC - varchar - 10 - PK,FK*/

CREATE TABLE DIEUKIEN
(MAMH CHAR(6) NOT NULL,
MAMH_TRUOC CHAR(6) NOT NULL,
CONSTRAINT PK_MAMH_MAMH_TRUOC PRIMARY KEY(MAMH,MAMH_TRUOC),
CONSTRAINT FK_MH FOREIGN KEY (MAMH) REFERENCES dbo.MONHOC(MAMH),
CONSTRAINT FK_MH_TRUOC FOREIGN KEY (MAMH_TRUOC) REFERENCES dbo.MONHOC(MAMH)
)
GO


/****THAO TÁC VỚI DỮ LIỆU***
1. Nhập dữ liệu
INSERT INTO <TÊN BẢNG> [THUỘC TÍNH] VALUES <DỮ LIỆU THEO THỨ TỰ THUỘC TÍNH ĐÃ LIỆT KÊ   >*/

--Chèn dữ liệu vào KHOA
INSERT INTO dbo.KHOA(MAKHOA,TENKHOA,NAMTL) VALUES
('TKTH',N'Thống kê tin học',2005),
('KT',N'Kế toán',1994),
('MKT',N'Marketing',2001),
('DL',N'Du lịch',2012),
('QTKD',N'Quản trị kinh doanh',1992)
GO

--Chèn dữ liệu vào SINHVIEN
INSERT INTO dbo.SINHVIEN(MASV,TEN,NAM,MAKHOA,NGAYSINH)VALUES
('SV001',N'Trần Lệ Quyên',2,'TKTH','01/21/2003'),
('SV002',N'Nguyễn Thế Bình',3,'MKT','06/04/2002'),
('SV003',N'Tô Ánh Nguyệt',2,'TKTH','05/02/2003'),
('SV004',N'Nguyễn Thế Anh',2,'DL','12/15/2003'),
('SV005',N'Lê Thanh Bình',2,'KT','12/09/2003'),
('SV006',N'Phạm Quang Hậu',3,'DL','10/12/2002'),
('SV007',N'Lê Cẩm Tú',4,'MKT','02/13/2001'),
('SV008',N'Trương Thế Sang',4,'QTKD','04/04/2003'),
('SV009',N'Đậu Quang Ánh',3,'TKTH','12/03/2002'),
('SV0010',N'Huỳnh Kim Chi',2,'KT','10/18/2003'),
('SV0011',N'Trịnh Đình Ánh',3,'QTKD','11/15/2002')
GO

--Chèn dữ liệu cho MONHOC
INSERT INTO dbo.MONHOC(MAMH,TENMH,TINCHI,MAKHOA)VALUES
('CSDL',N'Cơ sở dữ liệu',3,'TKTH'),
('CSLT',N'Cơ sở lập trình',3,'TKTH'),
('KTVM',N'Kinh tế vi mô',3,'QTKD'),
('MKTCB',N'Marketing căn bản',3,'MKT'),
('KTTC',N'Kế toán tài chính',3,'KT'),
('THUD',N'Tin học ứng dụng',3,'TKTH')
GO

--Chèn dữ liệu cho DIEUKIEN
INSERT INTO dbo.DIEUKIEN(MAMH, MAMH_TRUOC)VALUES
('CSLT','CSDL'),
('MKTCB','KTVM'),
('KTTC','MKTCB')
GO

--Chèn dữ liệu cho HOCPHAN
INSERT INTO dbo.HOCPHAN(MAHP,HOCKY,NAMHOC,GIAOVIEN,MAMH)VALUES
('CSDL_2111',1,2021,N'Uyên Nhi','CSDL'),
('CSLT_2011',2,2020,N'Thu Thảo','CSLT'),
('KTVM_2122',2,2021,N'Minh Hoàng','KTVM'),
('MKTCB_2211',1,2022,N'Châu Linh','MKTCB'),
('KTTC_1922',2,2019,N'Phương Nam','KTTC'),
('THUD_2011',1,2020,N'Đình Vấn','THUD')
GO

--Chèn dữ liệu cho KETQUA
INSERT INTO dbo.KETQUA(MASV,MAHP,DIEM) VALUES
('SV001','CSDL_2111',9.0),
('SV002','CSLT_2011',3.0),
('SV002','KTVM_2122',7.0),
('SV004','MKTCB_2211',6.0),
('SV004','KTTC_1922',5.0),
('SV005','THUD_2011',3.0),
('SV005','CSDL_2111',6.0),
('SV006','CSDL_2111',4.0),
('SV009','THUD_2011',4.0),
('SV0010','THUD_2011',8.0),
('SV001','KTTC_1922',7.0)
GO

--=========================================================