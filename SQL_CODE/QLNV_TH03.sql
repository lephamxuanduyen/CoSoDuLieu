CREATE DATABASE QLNV_TH3
ON
(
NAME = 'QLNV_TH3',
FILENAME = 'F:\CSDL\SQL_DATA\QLNV_TH3.mdf',
SIZE = 10MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 5MB)
LOG ON
(
NAME = 'QLNV_TH3_LOG',
FILENAME = 'F:\CSDL\SQL_DATA\QLNV_TH3_LOG.ldf',
SIZE = 5MB,
MAXSIZE = UNLIMITED,
FILEGROWTH = 2MB)

USE QLNV_TH3

CREATE TABLE PHONG
(MAPHONG CHAR(3) CONSTRAINT PK_PHG PRIMARY KEY,
TENPHONG NVARCHAR(40),
DIACHI NVARCHAR(50),
TEL CHAR(10))
GO

CREATE TABLE DMNN
(MANN CHAR(2) CONSTRAINT PK_NN PRIMARY KEY,
TENNN NVARCHAR(20))

CREATE TABLE NHANVIEN
(MANV CHAR(5) CONSTRAINT PK_NV PRIMARY KEY,
HOTEN NVARCHAR(40),
GIOITINH NVARCHAR(3) CONSTRAINT CHK_GT CHECK(GIOITINH IN (N'Nam',N'Nữ')),
NGAYSINH DATE,
LUONG INT,
MAPHONG CHAR(3)
CONSTRAINT FK_NV_PHG FOREIGN KEY(MAPHONG) REFERENCES PHONG(MAPHONG),
SDT CHAR(10),
NGAYBC DATE)

CREATE TABLE TDNN
(
MANV CHAR(5) NOT NULL,
MANN CHAR(2) NOT NULL,
CONSTRAINT PK_TDNN PRIMARY KEY(MANV, MANN),
CONSTRAINT FK_NV_TDNN FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
CONSTRAINT FK_NN_TDNN FOREIGN KEY(MANN) REFERENCES DMNN(MANN),
TDO CHAR(1))
GO

INSERT INTO PHONG VALUES
('HCA',N'Hành chính tổ hợp',N'123, Láng Hạ, Đống Đa, Hà Nội','04 8585793'),
('KDA',N'Kinh Doanh',N'123, Láng Hạ, Đống Đa, Hà Nội','04 8574943'),
('KTA',N'Kỹ thuật',N'123, Láng Hạ, Đống Đa, Hà Nội','04 9480485'),
('QTA',N'Quản trị',N'123, Láng Hạ, Đống Đa, Hà Nội','04 8508585')
GO

INSERT INTO DMNN VALUES
('01',N'Anh'),
('02',N'Nga'),
('03',N'Pháp'),
('04',N'Nhật'),
('05',N'Trung Quốc'),
('06',N'Hàn Quốc')
GO

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, LUONG, MAPHONG, NGAYBC) VALUES
('HC001',N'Nguyễn Thị Hà',N'Nữ','8/27/1950',2500000,'HCA','2/8/1975'),
('HC002',N'Trần Văn Nam',N'Nam','6/12/1975',3000000,'HCA','6/8/1997'),
('HC003',N'Nguyễn Thanh Huyền',N'Nữ','7/3/1978',1500000,'HCA','9/24/1999'),
('KD001',N'Lê Tuyết Anh',N'Nữ','2/3/1977',2500000,'KDA','10/2/2001'),
('KD002',N'Nguyễn Anh Tú',N'Nam','7/4/1942',2600000,'KDA','9/24/1999'),
('KD003',N'Phạm An Thái',N'Nam','5/9/1977',1600000,'KDA','9/24/1999'),
('KD004',N'Lê Văn Hải',N'Nam','1/2/1976',2700000,'KDA','6/8/1997'),
('KD005',N'Nguyễn Phương Minh',N'Nam','1/2/1980',2000000,'KDA','10/2/2001'),
('KT001',N'Trần Đình Khâm',N'Nam','12/2/1981',2700000,'KTA','1/1/2005'),
('KT002',N'Nguyễn Mạnh Hùng',N'Nam','8/16/1980',2300000,'KTA','1/1/2005'),
('KT003',N'Phạm Thanh Sơn',N'Nam','8/20/1984',2000000,'KTA','1/1/2005'),
('KT004',N'Vũ Thị Hoài',N'Nữ','12/5/1980',2500000,'KTA','10/2/2001'),
('KT005',N'Nguyễn Thu Lan',N'Nữ','10/5/1977',3000000,'KTA','10/2/2001'),
('KT006',N'Trần Hoài Nam',N'Nam','7/2/1978',2800000,'KTA','6/8/1997'),
('KT007',N'Hoàng Nam Sơn',N'Nam','12/3/1940',3000000,'KTA','7/2/1965'),
('KT008',N'Lê Thu Trang',N'Nữ','7/6/1950',2500000,'KTA','8/2/1968'),
('KT009',N'Khúc Nam Hải',N'Nam','7/22/1980',2000000,'KTA','1/1/2005'),
('KT010',N'Phùng Trung Dũng',N'Nam','8/28/1978',2200000,'KTA','9/24/1999')
GO

INSERT INTO TDNN VALUES
('HC001','01','A'),
('HC001','02','B'),
('HC002','01','C'),
('HC002','03','C'),
('HC003','01','D'),
('KD001','01','C'),
('KD001','02','C'),
('KD002','01','B'),
('KD002','02','D'),
('KD003','01','A'),
('KD003','02','B'),
('KD004','01','C'),
('KD004','04','C'),
('KD004','05','A'),
('KD005','01','A'),
('KD005','02','B'),
('KD005','03','D'),
('KD005','04','B'),
('KT001','01','B'),
('KT001','04','D'),
('KT002','01','E'),
('KT002','02','C'),
('KT003','01','B'),
('KT003','03','D'),
('KT004','01','C'),
('KT005','01','D')
GO

--CÂU 1
SELECT NV.MANV, HOTEN N'Họ tên', NGAYSINH N'Ngày sinh', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng', TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN AND NV.MANV='KT001'
GO

--CÂU 3
SELECT NV.MANV, HOTEN N'Họ tên', NGAYSINH N'Ngày sinh', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND GIOITINH=N'Nữ'
GO

--CÂU 4
SELECT NV.MANV, HOTEN N'Họ tên', NGAYSINH N'Ngày sinh', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND HOTEN LIKE N'NGUYỄN%'
GO

--CÂU 5
SELECT NV.MANV, HOTEN N'Họ tên', NGAYSINH N'Ngày sinh', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND HOTEN LIKE N'%VĂN%'
GO

--CÂU 6
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND (YEAR(GETDATE())-YEAR(NGAYSINH))<30
GO

--CÂU 7
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND (YEAR(GETDATE())-YEAR(NGAYSINH))<30 AND (YEAR(GETDATE())-YEAR(NGAYSINH))>25
GO

--CÂU 8
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng', TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN AND TDO>='C'
GO

--CÂU 9
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng', NGAYBC--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND YEAR(NGAYBC)<2000
GO

--CÂU 10
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng', YEAR(GETDATE())-YEAR(NGAYBC) N'Năm biên chế'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND YEAR(GETDATE())-YEAR(NGAYBC)>10
GO

--CÂU 11
SELECT NV.MANV, HOTEN N'Họ tên',YEAR(GETDATE())-YEAR(NGAYSINH) N'Tuổi', GIOITINH N'Giới tính',LUONG, TENPHONG N'Tên phòng'--, TENNN N'Ngoại ngữ',TDO N'Trình độ'
FROM NHANVIEN NV, PHONG P--, DMNN NN,TDNN TD
WHERE NV.MAPHONG=P.MAPHONG/* AND NV.MANV=TD.MANV AND NN.MANN=TD.MANN*/ AND ((YEAR(GETDATE())-YEAR(NGAYSINH)>=60 AND GIOITINH=N'Nam') OR (YEAR(GETDATE())-YEAR(NGAYSINH)>=55 AND GIOITINH=N'Nữ'))
GO

--CÂU 12
SELECT MAPHONG,TENPHONG,TEL
FROM PHONG 

--CÂU 13
SELECT TOP 2 HOTEN, NGAYSINH, NGAYBC
FROM NHANVIEN

--CÂU 14
SELECT MANV, HOTEN, NGAYSINH, LUONG
FROM NHANVIEN
WHERE LUONG>=2000000 AND LUONG<=3000000

--CÂU 15
SELECT MANV, HOTEN, NGAYSINH
FROM NHANVIEN
WHERE SDT IS NULL

--CÂU 16
SELECT * FROM NHANVIEN
SELECT MANV, HOTEN, NGAYSINH
FROM NHANVIEN
WHERE MONTH(NGAYSINH)=3
GO
/*INSERT INTO NHANVIEN VALUES
('KD006',N'Lê Phạm Xuân Duyên',N'Nữ','03/13/2003',5000000,'KDA','0905800106','07/13/2021')
*/

--CÂU 17
SELECT MANV, HOTEN, NGAYSINH, LUONG
FROM NHANVIEN
ORDER BY LUONG ASC
GO

--CÂU 18
SELECT P.MAPHONG,TENPHONG,AVG(LUONG) N'Lương trung bình'
FROM PHONG P JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
WHERE TENPHONG=N'KINH DOANH'
GROUP BY P.MAPHONG,TENPHONG
GO

--CÂU 19
SELECT P.MAPHONG,TENPHONG,COUNT(MANV) N'Số lượng nhân viên',AVG(LUONG) N'Lương trung bình'
FROM PHONG P JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
WHERE TENPHONG=N'KINH DOANH'
GROUP BY P.MAPHONG,TENPHONG
GO

--CÂU 20
SELECT P.MAPHONG,TENPHONG,SUM(LUONG) N'Tổng lương'
FROM PHONG P JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
GROUP BY P.MAPHONG,TENPHONG
GO

--CÂU 21
SELECT P.MAPHONG,TENPHONG,SUM(LUONG) N'Tổng lương'
FROM PHONG P JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
GROUP BY P.MAPHONG,TENPHONG
HAVING SUM(LUONG)>5000000
GO

--CÂU 22
SELECT MANV,HOTEN, P.MAPHONG,TENPHONG
FROM PHONG P JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
GO

--CÂU 23
SELECT MANV,HOTEN, P.MAPHONG,TENPHONG
FROM PHONG P RIGHT OUTER JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
GO

--CÂU 24
SELECT MANV,HOTEN, P.MAPHONG,TENPHONG
FROM PHONG P LEFT OUTER JOIN NHANVIEN NV ON P.MAPHONG=NV.MAPHONG
GO